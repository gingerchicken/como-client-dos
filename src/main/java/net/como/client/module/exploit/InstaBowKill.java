package net.como.client.module.exploit;

import net.como.client.ComoClient;
import net.como.client.event.EventHandler;
import net.como.client.event.impl.StopUsingItemEvent;
import net.como.client.module.Module;
import net.minecraft.client.network.ClientPlayNetworkHandler;
import net.minecraft.client.network.ClientPlayerEntity;
import net.minecraft.item.ItemStack;
import net.minecraft.item.Items;
import net.minecraft.network.packet.c2s.play.ClientCommandC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;

public class InstaBowKill extends Module {
    // TODO make this a setting
    public int multiplier = 100;

    public InstaBowKill() {
        this.setCategory("Exploit");
        this.setDescription("An old exploit that allows you to kill players with a bow instantly.");
    }

    @EventHandler
    public void onStopUsingItem(StopUsingItemEvent event) {
        // Make sure that the event is for the local player
        ClientPlayerEntity me = ComoClient.getInstance().me();
        if (event.player != me) return;

        // Ensure that we are using a bow
        ItemStack mainStack = me.getMainHandStack();
        if (!mainStack.getItem().equals(Items.BOW)) return;

        // Send the packets
        ClientPlayNetworkHandler networkHandler = ComoClient.getInstance().getClient().getNetworkHandler();
        networkHandler.sendPacket(new ClientCommandC2SPacket(me, ClientCommandC2SPacket.Mode.START_SPRINTING));

        for (int i = 0; i < multiplier; i++) {
            // First inaccuracy
            networkHandler.sendPacket(
                    new PlayerMoveC2SPacket.PositionAndOnGround(me.getX(), me.getY() - 0.000000001, me.getZ(), true)
            );

            // Second inaccuracy
            networkHandler.sendPacket(
                    new PlayerMoveC2SPacket.PositionAndOnGround(me.getX(), me.getY() + 0.000000001, me.getZ(), false)
            );
        }
    }
}
